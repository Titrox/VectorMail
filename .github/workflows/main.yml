name: Build and Deploy Frontend to Backend

on:
  push:
    branches:
      - master 
      - frontend
  pull_request:
    branches:
      - master 
      - frontend
  workflow_dispatch: # enables "Run workflow" button on the Actions tab.

jobs:
  build-and-package:
    runs-on: ubuntu-latest 

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4 

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20' 

    - name: Install Frontend Dependencies
      run: npm install 
      working-directory: ./frontend 

    - name: Build Frontend
      run: npm run build 
      working-directory: ./frontend

    - name: Set up Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin' 
        java-version: '17' 
        cache: 'maven'

    - name: Clean and Prepare Backend Static Resources
      run: |
        rm -rf src/main/resources/static/*
        mkdir -p src/main/resources/static/
      working-directory: ./api

    - name: Copy Frontend Build to Backend Static Resources
      run: cp -r ../frontend/dist/. src/main/resources/static/
      working-directory: ./api

    - name: Build Spring Boot Application
      run: mvn clean package 
      working-directory: ./api

    - name: Upload Spring Boot JAR as Artifact
      uses: actions/upload-artifact@v4
      with:
        name: spring-boot-app
        path: backend/target/*.jar 
